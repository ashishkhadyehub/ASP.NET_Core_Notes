using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Project2.Repositories.Interfaces;
using Project2.UI.ViewModels;
using System.Security.Claims;

namespace Project2.UI.Controllers
{
    public class TicketsController : Controller
    {
        private readonly ITicketRepo _ticketRepo;

        public TicketsController(ITicketRepo ticketRepo)
        {
            _ticketRepo = ticketRepo;
        }

        [Authorize]
        public async Task&lt;IActionResult&gt; MyTickets()
        {
            var claimsIdentity = (ClaimsIdentity)User.Identity;
            var claim = claimsIdentity.FindFirst(ClaimTypes.NameIdentifier);
            var userId = claim.Value;
            var Bookings = await _ticketRepo.GetBookings(userId);
            List&lt;BookingViewModel&gt; vm = new List&lt;BookingViewModel&gt;();
            foreach (var booking in Bookings)
            {
                vm.Add(new BookingViewModel {
                    BookingId = booking.BookingId,
                    BookingDate =booking.BookingDate,
                    EventName=booking.Event.Name,
                    Tickets= booking.Tickets.Select(ticketVM=&gt;new TicketViewModel { SeatNumber = ticketVM.SeatNumber}).ToList(),
                });
            }
            return View(vm);
        }
    }
}